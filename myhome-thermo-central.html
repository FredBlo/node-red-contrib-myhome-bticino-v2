central unit<script type="text/javascript">
  RED.nodes.registerType('myhome-thermo-central',{
    category: 'Bticino MyHome',
    color: '#a6bbcf',
    defaults: {
      name: { value: '', required: true },
      topic: { value: '', required: true},
      gateway: { type: 'myhome-gateway', required: true },
      smartfilter: { value: true, required: false},
      skipevents: { value: false, required: false},
      isstatusrequest: { value: false, required: false},
      output2_name: { value: 'On', required: false},
      output2_type: { value: 'text_state', required: false}
    },
    inputs: 1,
    inputLabels: function () {
      let inputLabel = this._("common.input-label-simple") + ":";
      inputLabel += "\n - 'ANTIFREEZE'                                              ";
      inputLabel += "\n - 'OFF_HEATING'                                           ";
      inputLabel += "\n - 'MANUAL_HEATING:xxxx'                           ";
      inputLabel += "\n - 'PROGRAM_HEATING:x'                            ";
      inputLabel += "\n - 'SCENARIO_HEATING:xx'                          ";
      inputLabel += "\n - 'THERMAL_PROTECT'                              ";
      inputLabel += "\n - 'OFF_CONDITIONING'                              ";
      inputLabel += "\n - 'MANUAL_CONDITIONING:xxxx'              ";
      inputLabel += "\n - 'PROGRAM_CONDITIONING:x'               ";
      inputLabel += "\n - 'SCENARIO_CONDITIONING:xx'             ";
      inputLabel += "\n - 'OFF'                                                              ";
      inputLabel += "\n - 'MANUAL:xxxx'                                              ";
      inputLabel += "\n - 'PROGRAM:x'                                               ";
      inputLabel += "\n - 'SCENARIO:xx'                                             ";
      return inputLabel;
    },
    outputs: 2,
    outputLabels: function (index) {
      if (index === 0) {
        return 'payload';
      } else if (index === 1) {
        let outputTypeDescr;
        if (this.output2_type === 'text_state') {
          outputTypeDescr = '°C';
        } else {
          outputTypeDescr = '.' + this.output2_type;
        }
        return 'payload' + ((this.output2_name === '') ? '' : ('.' + this.output2_name)) + " = " + outputTypeDescr;
      }
    },
    icon: 'mh-thermo-centralunit.svg',
    paletteLabel: 'MH Thermo Central',
    label: function() {
      return this.name || 'MH Thermo Central';
    },
    oneditprepare: function() {
      let scope = this;
      $(document).off('change', '#node-input-topic');
      $(document).on('change', '#node-input-topic', function() {
        let topicName = $('#node-input-topic').val();
        let topicInfo = scope._('common.topic-info' , {'topicName': topicName});
        $('#node-info-topic').prop('title' , topicInfo);
      });
    }
  });
</script>

<script type="text/x-red" data-template-name="myhome-thermo-central">
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Central unit identifier" />
  </div>
  <div class="form-row">
      <label for="node-input-topic"><i class="fa fa-terminal"></i> Topic</label>
      <input type="text" id="node-input-topic" placeholder="e.g. home" />
      &nbsp;<i id="node-info-topic" class="fa fa-info-circle" title=""></i>
  </div>
    <div class="form-row">
        <label for="node-input-gateway"><i class="fa fa-server"></i> Gateway</label>
        <input type="text" id="node-input-gateway" />
    </div>
    <div style="border-top-style: solid ;border-width: 1px; border-color: #CCCCCC; height: 10px;"></div>
    <div class="form-row">
      <label for="node-input-smartfilter"><i class="fa fa-filter"></i> SmartFilter</label>
      <label for="node-input-smartfilter" style="width:70%">
        <input type="checkbox" id="node-input-smartfilter" style="display:inline-block; margin-left:0px; width:22px; vertical-align:baseline;" />Enable 'Smart filtering' of gateway events
        &nbsp;<i class="fa fa-info-circle" title="SmartFilter is enabled by default, making the node only triggering a new flow (aka output) when a state CHANGED after a MyHome BUS message was received.
This is made to avoid multiple flows starting for the same info/command, because MyHome sends the same message multiple times (for status request, response,...)
&#13;
Note: SmartFilter is never applied when node is running in read-only (status update request) mode."></i>
      </label>
    </div>
    <div class="form-row">
        <label for="node-input-skipevents"><i class="fa fa-ban"></i> Skip events</label>
        <label for="node-input-skipevents" style="width:70%">
          <input type="checkbox" id="node-input-skipevents" style="display:inline-block; margin-left:0px; width:22px; vertical-align:baseline;" />Skip incoming events from gateway
          &nbsp;<i class="fa fa-info-circle" title="If necessary, all MyHome status updates received from the gateway about this node can be ignored, which means only Node-RED received payloads will be processed."></i>
        </label>
    </div>
    <div class="form-row">
        <label for="node-input-isstatusrequest"><i class="fa fa-eye"></i> Read-only</label>
        <label for="node-input-isstatusrequest" style="width:70%">
          <input type="checkbox" id="node-input-isstatusrequest" style="display:inline-block; margin-left:0px; width:22px; vertical-align:baseline;" />Only ask for current central unit status
          &nbsp;<i class="fa fa-info-circle" title="When enabled, the received payload (whatever it contains) is ignored and a status request is sent to gather current zone state without applying any change."></i>
        </label>
    </div>
    <div class="form-tips form-row" style="background:#EFEFEF">
      <i class="fa fa-sign-out"></i> <b>Secondary output options</b>
      <br>
      You may fine-tune the secondary output to better suit your needs when integrating with other node mechanisms (see node help for more info).
      <br>
      <div class="form-row">
        <label for="node-input-output2_name" style="width:35%; margin-left:15px"><i class="fa fa-tags"></i> Property name</label>
        <input type="text" id="node-input-output2_name" placeholder="e.g. On / state / ... / (empty)" style="width:55%" />
        <label for="node-input-output2_name" style="width:15px">
          &nbsp;<i class="fa fa-info-circle" title="Is the property name on the returned payload (i.e. payload.propertyname). When left empty, the payload is returned as a single value (i.e. not as an object)"></i>
        </label>
      </div>
      <div class="form-row">
        <label for="node-input-output2_type" style="width:35%; margin-left:15px"><i class="fa fa-check-square-o"></i> Data type</label>
        <select id="node-input-output2_type" style="width:55%">
          <option value="text_state">.state (string: see doc)</option>
          <option value="operationMode">.operationMode (string: see doc)</option>
          <option value="operationMode_ownValue">.operationMode_ownValue (string: see doc)</option>
          <option value="operationMode_setTemperature">.operationMode_setTemperature (number: °C)</option>
          <option value="operationMode_curProgram">.operationMode_curProgram (string: 1-3)</option>
          <option value="operationMode_curScenario">.operationMode_curScenario (string: 01-16)</option>
          <option value="remoteControl">.remoteControl (boolean: true / false)</option>
        </select>
      </div>
    </div>
</script>
